<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fretes | NOVA FROTA</title>

  <link rel="stylesheet" href="../assets/css/app.css" />

  <style>
    /* ====== BASE (densidade / planilha) ====== */
    .container{max-width:1400px}
    .card{padding:14px; overflow:hidden}
    .tableWrap{
      overflow:auto;
      border:1px solid rgba(43,58,114,.35);
      border-radius:14px;
      height: calc(100vh - 300px);
      min-height: 420px;
      background:#fff;
    }
    @media (max-width:1100px){
      .tableWrap{height:auto; min-height:360px;}
    }
    table{width:100%; border-collapse:collapse; min-width:1400px; background:#fff;}
    th,td{
      padding:6px 10px;
      border-bottom:1px solid #D1D5DB;
      font-size:12px;
      vertical-align:middle;
      white-space:nowrap;
      color:#111827;
    }
    thead th{
      position:sticky; top:0; z-index:3;
      background:#0F172A;
      color:#fff;
      border-bottom:1px solid #0B1220;
      font-size:11px;
      letter-spacing:.02em;
    }
    tbody tr:nth-child(even){background:#F1F4F9;}
    tbody tr:hover{background:#E8EDFF;}
    .rowSlim td{padding-top:5px; padding-bottom:5px;}

    /* pills */
    .muted2{color: rgba(17,24,39,.70);}

    /* ====== LAYOUT ====== */
    .container.nfWide{max-width: 1650px;}
    .container.pageFretes{
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:calc(100vh - 72px);
      padding-bottom:18px;
      background:#F5F7FA;
    }

    .card.tableFull{
      flex:1 1 auto;
      display:flex;
      flex-direction:column;
      min-height:380px;
      background:#FFFFFF;
      border:1px solid #E5E7EB;
      box-shadow:0 4px 12px rgba(0,0,0,.04);
      border-radius:18px;
    }
    .card.tableFull .tableWrap{
      flex:1 1 auto;
      max-height:none !important;
      height:auto !important;
    }

    /* ====== TOP minimalista ====== */
    .fretes-top{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      padding:12px 14px;
      background:#FFFFFF;
      border:1px solid #E5E7EB;
      border-radius:18px;
      box-shadow:0 4px 12px rgba(0,0,0,.04);
    }
    .fretes-top .title{display:flex; flex-direction:column; gap:4px;}
    .fretes-top .title h1{
      margin:0;
      font-size:18px;
      font-weight:900;
      letter-spacing:.2px;
      color:#0F172A;
    }
    .fretes-top .title .sub{
      font-size:12px;
      color: rgba(17,24,39,.70);
      max-width: 980px;
    }

    /* ====== toolbar compacta ====== */
    .fretes-toolbar{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      padding:10px 12px;
      border-radius:18px;
      border:1px solid #E5E7EB;
      background:#FFFFFF;
      box-shadow:0 4px 12px rgba(0,0,0,.04);
    }
    .ft-block{display:flex; align-items:center; gap:10px; flex-wrap:wrap;}
    .ft-spacer{flex:1 1 auto; min-width:10px}
    .ft-label{
      font-size:11px;
      font-weight:900;
      opacity:.9;
      color:#0F172A;
      margin-right:2px;
    }
    .ft-mini{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:11px;
      font-weight:900;
      color:#0F172A;
      opacity:.95;
    }
    .ft-mini input{
      width:66px;
      height:32px;
      padding:6px 8px;
      border-radius:10px;
      border:1px solid #D1D5DB;
      background:#FFFFFF;
      color:#111827;
      outline:none;
    }
    .ft-mini input:focus{
      border-color:#5B7CFA;
      box-shadow:0 0 0 3px rgba(91,124,250,.18);
    }
    .ft-select, .ft-search{
      height:32px;
      padding:6px 10px;
      border-radius:10px;
      border:1px solid #D1D5DB;
      background:#FFFFFF;
      color:#111827;
      outline:none;
    }
    .ft-select{width:200px}
    .ft-search{width:min(380px, 55vw)}
    @media (max-width:700px){
      .ft-select,.ft-search{width:100%}
    }

    .btnTiny{
      height:32px;
      padding:0 12px;
      border-radius:12px;
      border:1px solid rgba(15,23,42,.14);
      background:#0F172A;
      color:#FFFFFF;
      font-weight:900;
      cursor:pointer;
      white-space:nowrap;
    }
    .btnTiny:hover{filter:brightness(1.06)}
    .btnTiny.green{background:#0B3B2E; border-color:rgba(6,118,71,.25)}
    .btnTiny.ghost{
      background:#FFFFFF;
      color:#0F172A;
      border:1px solid #D1D5DB;
    }
    .btnTiny.blue{
      background:#102A6B;
      border-color:rgba(59,130,246,.35);
    }

    .num{text-align:right;}

    /* ======================================================
       ‚úÖ FOR√áA MAI√öSCULO NA UI (inputs/selects/textarea)
    ======================================================= */
    input, select, textarea { text-transform: uppercase; }

    /* ======================================================
       ‚úÖ WhatsApp: √≠cone
    ======================================================= */
    .waIcon{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:28px;
      height:28px;
      border-radius:10px;
      border:1px solid rgba(17,24,39,.12);
      background:#fff;
      padding:0;
      line-height:1;
    }
    .waIcon:hover{
      filter:brightness(1.03);
      box-shadow:0 2px 10px rgba(0,0,0,.08);
    }
    .waIcon img{
      width:18px;
      height:18px;
      display:block;
    }

    /* ======================================================
       ‚úÖ P√≠lulas S/N (verde/vermelho sofisticado)
    ======================================================= */
    .pillSN{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:30px;
      height:22px;
      border-radius:999px;
      font-weight:950;
      font-size:12px;
      letter-spacing:.02em;
      border:1px solid rgba(17,24,39,.18);
      box-shadow:0 2px 10px rgba(0,0,0,.06);
      user-select:none;
    }
    .pillSN.s{background:#DCFCE7;border-color:#86EFAC;color:#166534;}
    .pillSN.n{background:#FEE2E2;border-color:#FCA5A5;color:#7F1D1D;}
    .pillSN.empty{background:#EEF2F7;border-color:#CBD5E1;color:#475569;}

    /* ======================================================
       ‚úÖ Linha cabe√ßalho por FILIAL (groupRow)
    ======================================================= */
    .groupRow td{
      background:#0F172A !important;
      color:#fff !important;
      font-weight:900;
      letter-spacing:.02em;
      border-bottom:1px solid #0B1220;
      position:sticky;
      top:36px; /* abaixo do thead */
      z-index:2;
    }

    /* ======================================================
       ‚úÖ MODAL (Novo/Editar)
    ======================================================= */
    #modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
      background:rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
      padding:18px;
    }
    .modalCard{
      width:min(980px, 100%);
      background:#fff;
      border:1px solid #E5E7EB;
      border-radius:18px;
      box-shadow:0 18px 45px rgba(0,0,0,.28);
      overflow:hidden;
    }
    .modalHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px 14px;
      border-bottom:1px solid #E5E7EB;
      background:#F8FAFC;
    }
    .modalHead h2{
      margin:0;
      font-size:14px;
      font-weight:950;
      color:#0F172A;
    }
    .iconClose{
      width:34px;height:34px;border-radius:12px;
      border:1px solid #D1D5DB;
      background:#fff;
      cursor:pointer;
      font-weight:900;
      color:#0F172A;
    }
    .modalBody{
      padding:14px;
      max-height: calc(100vh - 220px);
      overflow:auto;
    }
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width:900px){
      .grid2{grid-template-columns:1fr;}
    }
    .field label{
      display:block;
      font-size:11px;
      font-weight:900;
      color:#0F172A;
      margin:0 0 6px;
    }
    .field input, .field select, .field textarea{
      width:100%;
      height:34px;
      padding:6px 10px;
      border-radius:12px;
      border:1px solid #D1D5DB;
      background:#fff;
      outline:none;
      color:#111827;
      font-size:12px;
    }
    .field textarea{
      height:auto;
      min-height:72px;
      resize:vertical;
    }
    .field input:focus, .field select:focus, .field textarea:focus{
      border-color:#5B7CFA;
      box-shadow:0 0 0 3px rgba(91,124,250,.18);
    }
    .modalFoot{
      display:flex;
      justify-content:flex-end;
      gap:10px;
      padding:12px 14px;
      border-top:1px solid #E5E7EB;
      background:#F8FAFC;
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <a class="burger" href="./home.html" title="Voltar"><div></div></a>
        <img src="../assets/img/logo-novafrota.png" alt="NOVA FROTA" />
      </div>
      <div class="actions">
        <div class="icon-btn" title="Sair" data-logout>üë§</div>
      </div>
    </div>
  </div>

  <div class="container nfWide pageFretes" style="padding-top:18px;">
    <!-- T√çTULO -->
    <div class="card fretes-top">
      <div class="title">
        <h1>
          Fretes (Operacional)
          <span id="syncStatus" data-sync-status style="font-size:12px; opacity:0.7; margin-left:10px;">üîÑ Carregando...</span>
        </h1>
        <div class="sub">
          Permiss√£o Frete M√≠nimo: indica quais tipos (eixos) atendem o piso m√≠nimo ANTT por embarque.
          <b>Dados sincronizados com Google Sheets em tempo real.</b>
        </div>
      </div>
    </div>

    <!-- BARRA COMPACTA -->
    <div class="fretes-toolbar">
      <div class="ft-block">
        <span class="ft-label">Pesos:</span>

        <div class="ft-mini"><span>9E</span><input id="w9" type="number" step="0.01" value="47" /></div>
        <div class="ft-mini"><span>4E</span><input id="w4" type="number" step="0.01" value="39" /></div>
        <div class="ft-mini"><span>7E</span><input id="w7" type="number" step="0.01" value="36" /></div>
        <div class="ft-mini"><span>6E</span><input id="w6" type="number" step="0.01" value="31" /></div>

        <button class="btnTiny" id="btnSaveWeights" type="button">Salvar</button>
        <button class="btnTiny ghost" id="btnResetWeights" type="button">Reset</button>
      </div>

      <div class="ft-spacer"></div>

      <div class="ft-block">
        <!-- ‚úÖ NOVO: REGIONAL -->
        <select class="ft-select" id="fRegional" title="Regional">
          <option value="">Todas as regionais</option>
        </select>

        <!-- ‚úÖ FILIAL (j√° existia) -->
        <select class="ft-select" id="fFilial" title="Filial">
          <option value="">Todas as filiais</option>
        </select>

        <!-- ‚úÖ NOVO: CONTATO -->
        <select class="ft-select" id="fContato" title="Contato">
          <option value="">Todos os contatos</option>
        </select>

        <input class="ft-search" id="fBusca" placeholder="Buscar (cliente, origem, destino, produto, contato)..." />

        <button class="btnTiny" id="btnReloadFromSheets" data-action="atualizar" type="button" title="Atualizar dados do Google Sheets">
          üîÑ Atualizar
        </button>

        <button class="btnTiny blue" id="btnShareClientes" type="button" title="Abrir Share Clientes">
          Share Clientes
        </button>

        <button class="btnTiny green" id="btnNew" data-action="novo" type="button">+ Novo</button>

        <button class="btnTiny ghost" id="btnResetExample" type="button" style="display:none;" title="Restaura o exemplo local">
          Exemplo
        </button>
      </div>
    </div>

    <!-- TABELA -->
    <div class="card tableFull">
      <div class="tableWrap">
        <table>
          <thead>
            <tr>
              <th>Regional</th>
              <th>Filial</th>
              <th>Cliente</th>
              <th>Origem</th>
              <th>Coleta</th>
              <th>Contato</th>
              <th>Destino</th>
              <th>UF</th>
              <th>Descarga</th>
              <th class="num">Volume</th>
              <th class="num">Vlr Empresa</th>
              <th class="num">Vlr Motorista</th>
              <th class="num">KM</th>
              <th class="num">Ped√°gio/Eixo</th>

              <th class="num">5E</th>
              <th class="num">6E</th>
              <th class="num">7E</th>
              <th class="num">4E</th>
              <th class="num">9E</th>

              <th>Produto</th>
              <th>ICMS</th>
              <th class="num">Pedido SAT</th>
              <th class="num">Porta</th>
              <th class="num">Tr√¢nsito</th>
              <th>Status</th>
              <th>Observa√ß√µes</th>
              <th class="num">A√ß√µes</th>
            </tr>
          </thead>

          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ======================================================
       ‚úÖ MODAL NOVO/EDITAR (IDs compat√≠veis com fretes.js)
  ======================================================= -->
  <div id="modal" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHead">
        <h2 id="modalTitle">Novo Frete</h2>
        <button class="iconClose" id="btnCloseModal" type="button" title="Fechar">‚úï</button>
      </div>

      <div class="modalBody">
        <div class="grid2">
         <div class="field">
  <div class="field">
  <label>Regional</label>
  <select id="mRegional"></select>
</div>

<div class="field">
  <label>Filial</label>
  <select id="mFilial"></select>
</div>

<div class="field">
  <label>Cliente</label>
  <select id="mCliente"></select>
</div>

<div class="field">
  <label>Contato (Respons√°vel da Filial)</label>
  <select id="mContato" disabled></select>
</div>
          <div class="field"><label>Origem</label><input id="mOrigem" /></div>
          <div class="field"><label>Coleta</label><input id="mColeta" /></div>

          <div class="field"><label>Destino</label><input id="mDestino" /></div>
          <div class="field"><label>UF</label><input id="mUF" /></div>

          <div class="field"><label>Descarga</label><input id="mDescarga" /></div>
          <div class="field"><label>Produto</label><input id="mProduto" /></div>

          <div class="field"><label>KM</label><input id="mKM" inputmode="decimal" /></div>
          <div class="field"><label>Ped√°gio/Eixo</label><input id="mPed" inputmode="decimal" /></div>

          <div class="field"><label>Volume</label><input id="mVolume" inputmode="decimal" /></div>
          <div class="field"><label>ICMS</label><input id="mICMS" inputmode="decimal" /></div>

          <div class="field"><label>Vlr Empresa</label><input id="mEmpresa" inputmode="decimal" /></div>
          <div class="field"><label>Vlr Motorista</label><input id="mMotorista" inputmode="decimal" /></div>

          <div class="field"><label>Pedido SAT</label><input id="mSat" /></div>
          <div class="field"><label>Porta</label><input id="mPorta" /></div>

          <div class="field"><label>Tr√¢nsito</label><input id="mTransito" /></div>
          <div class="field">
            <label>Status</label>
            <select id="mStatus">
              <option value="LIBERADO">LIBERADO</option>
              <option value="EM ANALISE">EM AN√ÅLISE</option>
              <option value="BLOQUEADO">BLOQUEADO</option>
            </select>
          </div>

          <div class="field" style="grid-column: 1 / -1;">
            <label>Observa√ß√µes</label>
            <textarea id="mObs"></textarea>
          </div>
        </div>
      </div>

      <div class="modalFoot">
        <button class="btnTiny ghost" id="btnCancel" type="button">Cancelar</button>
        <button class="btnTiny green" id="btnSave" type="button">Salvar</button>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Scripts no final -->
  <script src="../assets/js/auth.js"></script>
  <script src="../assets/js/fretes.js"></script>

  <script>
    requireHomeAuth();
    bindLogoutButton();

    window.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("btnShareClientes");
      if(btn){
        btn.addEventListener("click", () => {
          window.location.href = "./share-clientes.html";
        });
      }

      // ‚úÖ Fechar modal (UI)
      const modal = document.getElementById("modal");
      const close = document.getElementById("btnCloseModal");
      const cancel = document.getElementById("btnCancel");
      function closeModal(){
        if(!modal) return;
        modal.style.display = "none";
        modal.setAttribute("aria-hidden","true");
      }
      close?.addEventListener("click", closeModal);
      cancel?.addEventListener("click", closeModal);
      modal?.addEventListener("click", (e)=>{ if(e.target && e.target.id==="modal") closeModal(); });
    });
  </script>
</body>
</html>
