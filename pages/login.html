<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login | NOVA FROTA</title>
  <link rel="stylesheet" href="../assets/css/app.css" />
</head>
<body>
  <div class="login-wrap">
    <div class="login-card">
      <div class="head">
        <img src="../assets/img/logo-novafrota.png" alt="NOVA FROTA" />
        <div>
          <div style="font-weight:900; font-size:16px">Sistema Operacional</div>
          <div style="font-size:12px; color: rgba(233,238,252,.75)">Acesso restrito</div>
        </div>
      </div>

      <label class="label" for="user">Usuário</label>
      <input class="input" id="user" placeholder="Ex.: Luziano" autocomplete="username" />

      <label class="label" for="pass">Senha</label>
      <input class="input" id="pass" type="password" placeholder="Digite a senha" autocomplete="current-password" />

      <button class="btn" id="btnLogin">Entrar</button>

      <div class="err" id="err">Usuário ou senha inválidos.</div>
      <div class="small">Dedicado - para NOVA FROTA ✅</div>
    </div>
  </div>

  <script src="../assets/js/auth.js"></script>
  <script>
    // Se já estiver logado, manda para Home (lá garante UF também)
    if(localStorage.getItem("nf_auth_home") === "1"){
      window.location.href = "./home.html";
    }

    const btn = document.getElementById("btnLogin");
    const err = document.getElementById("err");

    function waitForEstadoThenGoHome(){
      // se já tem UF, vai direto
      if(localStorage.getItem("nf_estado_ativo")){
        window.location.href = "./home.html";
        return;
      }
      // senão, espera o usuário clicar em um estado no modal
      const t = setInterval(() => {
        if(localStorage.getItem("nf_estado_ativo")){
          clearInterval(t);
          window.location.href = "./home.html";
        }
      }, 120);
    }

    function doLogin(){
      err.style.display = "none";
      const p = document.getElementById("pass").value.trim();

      if(p === AUTH.HOME_PASSWORD){
        // ✅ login + abre seletor de estado
        doHomeLogin();
        // ✅ só vai pro home depois que escolher UF
        waitForEstadoThenGoHome();
      }else{
        err.style.display = "block";
      }
    }

    btn.addEventListener("click", doLogin);
    document.getElementById("pass").addEventListener("keydown", (e)=>{
      if(e.key === "Enter") doLogin();
    });
  </script>
</body>
</html>
